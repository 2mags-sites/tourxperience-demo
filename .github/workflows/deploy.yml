name: Deploy to cPanel

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: 🚀 Checkout code
      uses: actions/checkout@v3
    
    - name: 🔍 Test SSH and Find Correct Path
      uses: appleboy/ssh-action@v0.1.7
      with:
        host: ${{ secrets.WHM_HOST }}
        username: ${{ secrets.WHM_USERNAME }}
        key: ${{ secrets.WHM_SSH_KEY }}
        script: |
          echo "=== Current directory ==="
          pwd
          echo "=== Home directory contents ==="
          ls -la /home/tourxgolfco/
          echo "=== Looking for demo subdomain ==="
          find /home/tourxgolfco -name "*demo*" -type d 2>/dev/null || true
          echo "=== Checking if demo.tourxgolf.co.uk exists ==="
          ls -la /home/tourxgolfco/demo.tourxgolf.co.uk/ 2>/dev/null || echo "Directory does not exist"
          echo "=== Checking public_html subdirectories ==="
          ls -la /home/tourxgolfco/public_html/ 2>/dev/null || true